diff -uBrN qtimer.orig/qtimer.pro qtimer/qtimer.pro
--- qtimer.orig/qtimer.pro	2012-12-19 17:28:49.000000000 +0200
+++ qtimer/qtimer.pro	2012-12-25 23:58:39.913334283 +0200
@@ -1,5 +1,8 @@
-CONFIG += testcase parallel_test
-TARGET = tst_qtimer
-QT = core testlib
-SOURCES = tst_qtimer.cpp
+CONFIG  += testcase
+TARGET   = tst_qtimer
+QT       = core testlib
+SOURCES  = tst_qtimer.cpp
 DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0
+DESTDIR  = ../
+
+include(../common.pri)
diff -uBrN qtimer.orig/tst_qtimer.cpp qtimer/tst_qtimer.cpp
--- qtimer.orig/tst_qtimer.cpp	2012-12-19 17:28:45.000000000 +0200
+++ qtimer/tst_qtimer.cpp	2012-12-25 23:51:35.905428096 +0200
@@ -39,13 +39,9 @@
 **
 ****************************************************************************/
 
-#ifdef QT_GUI_LIB
-#  include <QtGui/QGuiApplication>
-#else
 #  include <QtCore/QCoreApplication>
-#endif
-
 #include <QtTest/QtTest>
+#include "eventdispatcher_libev.h"
 
 #include <qtimer.h>
 #include <qthread.h>
@@ -396,6 +392,7 @@
     ti2.start(MOVETOTHREAD_TIMEOUT);
     QVERIFY((ti1.timerId() & 0xffffff) != (ti2.timerId() & 0xffffff));
     QThread tr;
+    tr.setEventDispatcher(new EventDispatcherLibEv());
     ti1.moveToThread(&tr);
     connect(&ti1,SIGNAL(timeout()), &tr, SLOT(quit()));
     tr.start();
@@ -555,6 +552,7 @@
 void tst_QTimer::timerIdPersistsAfterThreadExit()
 {
     TimerIdPersistsAfterThreadExitThread thread;
+    thread.setEventDispatcher(new EventDispatcherLibEv);
     thread.start();
     QVERIFY(thread.wait(30000));
     QCOMPARE(thread.returnValue, 0);
@@ -717,5 +715,12 @@
     QVERIFY(timerHelper.count > 5);
 }
 
-QTEST_MAIN(tst_QTimer)
 #include "tst_qtimer.moc"
+
+int main(int argc, char** argv)
+{
+	QCoreApplication::setEventDispatcher(new EventDispatcherLibEv);
+	QCoreApplication app(argc, argv);
+	tst_QTimer t;
+	return QTest::qExec(&t, argc, argv);
+}
